define("bundles/kingappform/js/form",["jquery","bundles/kingappcommon/js/alerter","./error","bundles/kingappcommon/js/browser","./validate","bundles/kingappcommon/js/jquery"],function(r,e,o,t,n){"use strict";function i(e){r(e.target).find(":input").val(""),r(e.target).find(".error").remove(),r(e.target).find(".form-error").removeClass("form-error")}function s(e){var o=r(e.target);o.is(":input")&&(o.prop("required")&&!o.val()?o.closest(".form-group").addClass("form-error"):(o.closest(".form-group").removeClass("form-error").find("span.error").remove(),o.closest(".form-error").removeClass("form-error")))}function a(i){i.stopPropagation(),i.preventDefault();var s=r(i.target).closest("form");if(s.find(".form-error").removeClass("form-error"),s.trigger("form.validate"),!function(r){return!n(r)}(s))return s.trigger("form.error");s.closest(".form-container").addClass("is-validated"),s.find("span.error").remove(),r.get("/form/_token/"+s.attr("name")).done(function(n){s.find("[name*=_token]").val(n),r[s.attr("method")]({url:s.attr("action")||window.location.href,container:s},s.serializeArray()).done(function(r){e.success(r.message),this.removeClass("dirty"),r.redirect&&(r.forceRedirect||window.location.pathname!==r.redirect)&&(r.navigate?window.location.href=r.redirect:t.redirect(r.redirect)),this.trigger("form.success",[r]),this.closest(".form-container").addClass("is-submitted"),r.redirect||r.hide||this.closest(".form-container").removeClass("is-submitted is-validated"),r.blank&&window.open(r.blank,"_blank"),r.reload&&t.reload()}.bind(s)).fail(o.bind(s))})}function d(e){r(e.target).closest(".form-error").removeClass("form-error"),r(e.target).closest("span.error").remove()}return function(e){r(e).each(function(){var e=r(this).closest("form");function o(){if(e.hasClass("dirty"))return confirm(e.data("unloadMessage"))}e.data("ajax")&&(e.on("submit",a),e.on("click","[type=ka-submit]",a)),e.on("form.reset",i),e.on("keyup change blur",s),e.on("click","span.error i",d),e.is(":visible")&&e.find(":input:visible:not([disabled])").filter(function(){return r(this).isInViewport()}).first().trigger("focus"),e.data("unloadMessage")&&(e.on("change keyup",function(r){r.isTrigger||e.addClass("dirty")}),e.on("navigate",o),window.onbeforeunload=o)})}});